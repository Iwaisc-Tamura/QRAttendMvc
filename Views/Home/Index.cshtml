@{
    Layout = null;
    ViewData["Title"] = "協力会社入退場記録システム";
}

<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"]</title>

    <!-- Bootstrap -->
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />

    <!-- 共通CSS -->
    <link rel="stylesheet" href="~/css/site.css" />
</head>

<body class="index-home">
    <div class="container-fluid">
        <div class="card">

            <!-- 上段：緑帯（タイトル中央） -->
            <header class="home-topbar bg-success text-white">
                <div class="home-topbar-title">
                    協力会社入退場記録システムメニュー
                </div>
            </header>

            <!-- 2段目：左にテストボタン／右にログイン・日付・時刻 -->
            <section class="home-subbar">
                <div class="home-sub-left">
                    <form asp-controller="TestUtility"
                          asp-action="UpdateTodayEventDate"
                          method="post"
                          onsubmit="return confirm('テスト用処理です。\n開催日を本日に更新します。\nよろしいですか？');">
                        <button type="submit" class="btn btn-warning fw-bold">
                            【テスト用】開催日を本日に更新
                        </button>
                    </form>
                </div>

                <div class="home-sub-right">
                    @{
                        var b = Context?.Session?.GetString("BRANCH_CD") ?? "";
                        var e = Context?.Session?.GetString("EMPLOYEE_CD") ?? "";
                        var login = (!string.IsNullOrEmpty(b) && !string.IsNullOrEmpty(e))
                        ? $"{b}-{e}"
                        : "XXXXX-YYYYY";
                    }

                    <div class="home-clock">
                        <div class="home-clock-row">
                            <span class="home-clock-label">ログイン</span>
                            <span class="home-clock-value">@login</span>
                        </div>

                        <div class="home-clock-row">
                            <span class="home-clock-label">日付</span>
                            <span class="home-clock-value" id="layoutDate"></span>
                        </div>

                        <div class="home-clock-row">
                            <span class="home-clock-label">時刻</span>
                            <span class="home-clock-value" id="layoutTime"></span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 白いメイン領域（中央配置） -->
            <main class="home-main">
                <div class="home-main-inner">
                    <h2 class="fw-bold home-main-title">入退場記録メインメニュー</h2>

                    <div class="text-center">
                        <a asp-controller="EventSelection"
                           asp-action="Index"
                           class="btn btn-primary btn-lg px-5 py-4 fw-bold home-btn">
                            イベント選択
                        </a>
                    </div>
                </div>
            </main>

        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- 右上：日付・時刻更新（画像の表示形式に合わせる） -->
    <script>
        function updateLayoutClock() {
            const d = new Date();
            const pad = n => String(n).padStart(2, '0');

            const week = ["(日)", "(月)", "(火)", "(水)", "(木)", "(金)", "(土)"];
            const w = week[d.getDay()];

            const date =
                d.getFullYear() + "/" +
                pad(d.getMonth() + 1) + "/" +
                pad(d.getDate()) + " " + w;

            //時：分：秒　に変更
            const time =
                pad(d.getHours()) + "：" +
                pad(d.getMinutes()) + "：" +
                pad(d.getSeconds());

            const elDate = document.getElementById("layoutDate");
            if (elDate) elDate.textContent = date;

            const elTime = document.getElementById("layoutTime");
            if (elTime) elTime.textContent = time;

            /*画面を開いた日時をセッションに記録する*/
            if (!sessionStorage.getItem("fixedLayoutTime")) {
                const now = new Date();
                sessionStorage.setItem("fixedLayoutTime", now.toISOString());
            }

        }

        updateLayoutClock();
        setInterval(updateLayoutClock, 1000);
    </script>
</body>
</html>